#!/bin/bash -e

# What is the cat command
CAT="cat"
hash vimcat 2> /dev/null && CAT="vimcat"

show_category() {
  command="$1"

  echo "============================== ${command} =============================="
  # cat "${script_dir}/cheats-scripts/${command}" | egrep -v '^exit' | egrep -v 'vim:\sft=' > "${TMP}/cheatsfile"
  cat "${script_dir}/cheats-scripts/${command}" | egrep -v '^exit' > "${TMP}/cheatsfile"
  $CAT "${TMP}/cheatsfile"
  rm   "${TMP}/cheatsfile"
}

script_dir="$(dirname $0)"

command="$1"
[[ -n $command ]] && shift

# --- List categories
if [[ $command == "ls" ]]; then
  ls "${script_dir}/cheats-scripts"
  exit 0
fi

# --- Show a single category
if [[ $# == 0 && -n $command ]]; then
  if [[ -f "${script_dir}/cheats-scripts/${command}" ]]; then
    show_category "${command}"
  else
    echo -n "Cannot find $command, try: "
    "${script_dir}/cheats" "ls"
  fi
  exit 0
fi

# --- Show all the categories
for f in `ls "${script_dir}/cheats-scripts"`; do
  show_category "$f"
done
exit 0

echo "Don't know what to do."
echo ""
echo "Usage: cheats [ls | name]"

